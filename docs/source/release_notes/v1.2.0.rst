.. _release_v1_2_0:

----------------
Version 1.2.0
----------------

*(Released: 2025-08-16)*

This is a major feature release that significantly expands the `k-diagram`
library's capabilities for error analysis and distribution visualization.
It introduces a new `errors` module with advanced polar plots for
diagnosing systemic vs. random errors, comparing multiple models, and
visualizing 2D uncertainty. Additionally, histogram and density
plotting utilities have been centralized and enhanced.

Highlights
~~~~~~~~~~~~~

* |Feature| **New Error Analysis Module** (`kdiagram.plot.errors`):

  A dedicated suite of plots for deep error diagnostics.
  
  - :func:`~kdiagram.plot.errors.plot_error_bands` to separate
    systemic bias from random error.
  - :func:`~kdiagram.plot.errors.plot_error_violins` to compare
    full error distributions of multiple models.
  - :func:`~kdiagram.plot.errors.plot_polar_error_ellipses` for
    visualizing 2D positional uncertainty.

* |Feature| **New Advanced Uncertainty Plots**:

  - :func:`~kdiagram.plot.uncertainty.plot_polar_heatmap` to find
    correlations between cyclical features and magnitudes.
  - :func:`~kdiagram.plot.uncertainty.plot_polar_quiver` to visualize
    vector fields like forecast revisions.

* |Feature| **New Histogram & Density Utilities** (`kdiagram.utils.hist`):

  - Centralized :func:`~kdiagram.utils.hist.plot_hist_kde` for
    robust 1D distribution plotting.
  - New :func:`~kdiagram.plot.uncertainty.plot_radial_density_ring`
    for visualizing 1D distributions in a polar format.

New Features
~~~~~~~~~~~~~

* |New| New module `kdiagram.plot.errors` with three powerful plots:

  - :func:`~kdiagram.plot.errors.plot_error_bands`: Aggregates errors
    into angular bins to plot mean error (bias) and a standard
    deviation band (variance).
  - :func:`~kdiagram.plot.errors.plot_error_violins`: Creates polar
    violin plots to compare the shape, bias, and variance of multiple
    error distributions simultaneously.
  - :func:`~kdiagram.plot.errors.plot_polar_error_ellipses`: Visualizes
    2D uncertainty by drawing confidence ellipses based on radial and
    angular standard deviations.

* |New| New plots added to `kdiagram.plot.uncertainty`:

  - :func:`~kdiagram.plot.uncertainty.plot_polar_heatmap`: Creates a
    2D density plot on a polar grid to identify "hot spots" where
    a radial metric and an angular feature concentrate.
  - :func:`~kdiagram.plot.uncertainty.plot_polar_quiver`: Draws vector
    arrows on a polar grid to show magnitude and direction, ideal for
    visualizing forecast updates or error vectors.

* |New| New utility module `kdiagram.utils.hist`:
  - :func:`~kdiagram.utils.hist.plot_hist_kde`: A robust, standalone
    function for plotting histograms with optional KDE overlays,
    supporting pandas DataFrames, Series, and NumPy arrays.

Enhancements
~~~~~~~~~~~~~

* |Enhancement| All new polar plots (`heatmap`, `quiver`, `ellipses`,
  `error_bands`) now include `mask_angle` and `mask_radius` parameters,
  giving users full control to hide meaningless axis labels for a
  cleaner presentation.
* |Enhancement| The API for new plots is designed for consistency with
  the existing `k-diagram` library, using standard parameters like
  `df`, `title`, `cmap`, `show_grid`, `grid_props`, and `savefig`.

API Changes
~~~~~~~~~~~~~

* |API Change| **None (backward compatible).** All new functions are
  additive. The new modules (`errors.py`, `hist.py`) are new additions
  and do not alter existing namespaces.

Bug Fixes
~~~~~~~~~~~

* |Fix| Resolved a `TypeError` in `plot_polar_heatmap` caused by an
  incorrect transpose of the counts array, ensuring compatibility with
  Matplotlib's `pcolormesh` dimension requirements.

Documentation
~~~~~~~~~~~~~~~

* |Docs| **New User Guides**:

  - Added a comprehensive `errors.rst` user guide with detailed
    explanations and mathematical formulations for `plot_error_bands`,
    `plot_error_violins`, and `plot_polar_error_ellipses`.
  - Added a new `hist.rst` user guide detailing the usage and
    concepts behind `plot_hist_kde`.

* |Docs| **New Gallery Pages**:

  - Created a new `errors.rst` gallery page with runnable examples and
    interpretation guides for all three new error plots.
  - Created a new `hist.rst` gallery page for `plot_hist_kde`.
  - Added new sections to the `uncertainty.rst` gallery for
    `plot_polar_heatmap` and `plot_polar_quiver`.

* |Docs| **New API Documentation**:

  - Added comprehensive, well-structured docstrings for all new
    functions, including mathematical notes, parameter descriptions,
    and runnable examples.

Testing & QA
~~~~~~~~~~~~~

* |Tests| New test suite `tests/test_plot_errors.py` covering:

  - `plot_error_bands`: Correct aggregation of mean and std dev in bins.
  - `plot_error_violins`: Correct rendering for single vs. multiple models.
  - `plot_polar_error_ellipses`: Correct ellipse shape and orientation.
  - Validation of masking parameters (`mask_angle`, `mask_radius`).

* |Tests| New test suite `tests/test_plot_uncertainty_advanced.py` covering:

  - `plot_polar_heatmap`: Correct binning and color mapping.
  - `plot_polar_quiver`: Correct vector placement and orientation.
  - Handling of `theta_period` for cyclical data.

* |Tests| New test suite `tests/test_hist.py` covering:

  - `plot_hist_kde`: Correct rendering from DataFrame, Series, and NumPy array.
  - Proper handling of `show_kde=False`.
